---
layout:     post
title:      "iOSé¡¹ç›®ä¸­å¸¸ç”¨çš„â€œæ‰“è¡¥ä¸â€æŠ€å·§"
subtitle:   "åªè¦è¡¥ä¸æ‰“å¾—å¥½ï¼Œéœ€æ±‚å˜æ›´éƒ½ä¸æ˜¯äº‹å„¿ï¼"
date:       2016-05-25 12:00:00
author:     "DavidDay"
header-img: "img/post/2016-5-25-bg.jpg"
tags:
    - åŸºç¡€æ•´ç†
    - å¤©æ€çš„éœ€æ±‚å˜æ›´
---



# iOSé¡¹ç›®ä¸­å¸¸ç”¨çš„â€œæ‰“è¡¥ä¸â€æŠ€å·§

å—¯ã€‚ã€‚æ€ä¹ˆå¼€ç¯‡å‘¢

ã€‚

ã€‚

(ä¸€ä¸ªå°æ—¶ã€‚ã€‚æ“è„šæ¯›è‹¦æ€ä¸­ã€‚ã€‚)

ã€‚

å‘µå‘µï¼Œä½ ä»¥ä¸ºåšä¸»çœŸçš„ä¸çŸ¥é“æ€ä¹ˆå¼€ç¯‡ä¹ˆï¼Œè¿™é‡ŒèŠ±äº†ä¸€ä¸ªå°æ—¶çš„æ—¶é—´å…¶å®æ˜¯å¦æœ‰æ·±æ„çš„å¥½ä¹ˆï¼Œæˆ‘çš„å¥—è·¯å°±æ˜¯è¿™ä¹ˆæ¹¿ï¼ï¼ï¼Œå…¶å®åšä¸»æ˜¯ä¸ºäº†é˜è¿°ä¸€ä¸ªé—®é¢˜ï¼å°±æ˜¯å¦‚æœåªæƒ³äº†ä¸€ä¸ªæ ‡é¢˜ï¼Œå†…å®¹å´ä¸çŸ¥é“æ€ä¹ˆç»„ç»‡å°±ä¼šæ˜¯è¿™æ ·çš„æ…¢æ€§å°´å°¬ç—‡ã€‚å°±åƒæˆ‘ä»¬åšé¡¹ç›®çš„æ—¶å€™ç»å¸¸è„‘è¢‹ä¸€çƒ­ï¼ŒäºŒè¯ä¸è¯´ä¸Šæ¥å°±æ’¸ä»£ç ã€‚ç„¶åå°±å‘ç°æ¡†æ¶ä¸è¡Œï¼Œä¸å¤Ÿçµæ´»æ— æ³•æ‰©å±•ï¼ŒåŠŸèƒ½ç¼ºå¤±ï¼ç„¶ååœ¨ä½ å‡†å¤‡è°ƒæ•´æ¶æ„çš„æ—¶å€™ï¼Œäº§å“ç»ç†å°±è·³å‡ºæ¥è¡¥ä¸Šä¸€åˆ€â€”â€”æ”¹éœ€æ±‚ã€‚

![](http://daiweilai.github.io/img/post/2016-5-25-pic1.gif)

è¿™ç§ç»æœ›ï¼Œæˆ‘ä»¬éƒ½ç»å†è¿‡ï¼

![](http://daiweilai.github.io/img/post/2016-5-25-pic2.jpg)

äº§å“ç»ç†å¸¸ç”¨å¿…æ€ï¼š

ã€ç”¨æˆ·ååº”ï¼ŒæŒ‰é’®åŒå‡»ä¼šæœ‰é”™è¯¯ï¼Œæ‰€ä»¥ä½ æŠŠæ•´ä¸ªé¡¹ç›®æœ‰äº¤äº’çš„æ§ä»¶éƒ½è®¾ç½®ä¸ºä¸èƒ½åŒå‡»å§ï¼Œå¹²å·´çˆ¹ã€

â€”â€”![](http://daiweilai.github.io/img/post/2016-5-25-pic3.jpg)

ã€è¿™ä¸ªè¾“å…¥æ¡†æ€ä¹ˆèƒ½è¾“å…¥ğŸµğŸµğŸµè¿™ä¸ªå‘¢ï¼ŒæŠŠæ‰€æœ‰çš„è¾“å…¥æ¡†éƒ½ç¦æ­¢è¾“å…¥ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿å§ï¼Œä¹ˆä¹ˆå“’ã€

â€”â€”è¿™ä¸ªæ˜¯emojiï¼Œå¹¶æ²¡æœ‰è¿™ä¹ˆä¹±ä¸ƒå…«ç³Ÿã€‚ã€‚

ã€å“¦ä¹‹å‰å¿˜äº†å®šä¹‰ï¼Œç»™æ‰€æœ‰çš„è¾“å…¥æ¡†éƒ½é™åˆ¶å¤§æ•°å§ã€ç»™æ‰€æœ‰çš„é¡µé¢éƒ½åŠ ä¸Šè¿”å›æ‰‹åŠ¿å§ï¼Œç»™æ‰€æœ‰çš„â€¦â€¦ã€

ã€çº¿ä¸Šæœ‰å‡ ä¸ªé¡µé¢æš‚æ—¶ä¸éœ€è¦äº†ï¼Œèƒ½å±è”½æ‰ä¹ˆã€

ã€‚ã€‚ã€‚

æˆ‘èƒ½å’Œäº§å“æ¢è®¨ä¸€ä¸‹å¼•åŠ›æ³¢çš„æ¢æµ‹ä¸å¹¿ä¹‰ç›¸å¯¹è®ºçš„å¿…ç„¶è”ç³»ä¹ˆï¼Ÿè€å­å¼„æ­»ä½ ä¸«çš„

![](http://daiweilai.github.io/img/post/2016-5-25-pic4.jpg)

æˆ‘æƒ³é¡¹ç›®æ–°äººå‡ ä¹éƒ½é‡åˆ°è¿‡è¿™äº›å‘å§ï¼Œäº§å“ç»ç†ä¸ä¸“ä¸šåœ¨ä¸€èˆ¬çš„å…¬å¸é‡Œæ˜¯å¸¸æ€ï¼Œç°åœ¨çš„äº’è”ç½‘ï¼Œä¸€è¨€ä¸åˆå°±æ”¹éœ€æ±‚ï¼Œä¹Ÿæ˜¯ä¸ªå¸¸æ€ã€‚

ä½†æ˜¯å¼ºå¤§çš„çŒ¿ç±»ä»¬ï¼Œå†³ä¸èƒ½å±ˆæœäºè¿™ç§å¸¸æ€ï¼Œå˜æ€èµ·æ¥ï¼ï¼

åªè¦åŠªåŠ›å¾®ç¬‘ï¼Œå‘½è¿ä¹Ÿä¼šæƒ§æ€•æˆ‘çš„ç ç‰™ã€‚

![](http://daiweilai.github.io/img/post/2016-5-25-pic5.jpg)

å›åˆ°è¿™æ¬¡çš„ä¸»é¢˜â€”â€”ã€æ‰“è¡¥ä¸ã€

ä»€ä¹ˆæ˜¯æ‰“è¡¥ä¸å‘¢ï¼Œæ‰“è¡¥ä¸æ˜¯ä½¿ç”¨é’ˆçº¿åœ¨ç»‡ç‰©ä¸Šè¾…ä»¥ç ´å¸ƒä»¥ç¼è¡¥ä¸Šï¼Œæ˜¯æ°‘é—´ä¼Ÿå¤§çš„ä¼ ç»Ÿæ‰‹å·¥è‰ºä¹‹ä¸€ã€‚è¯¥æŠ€è‰ºä¸¥è°¨ç²¾å¯†ï¼Œè®²ç©¶æ–½é’ˆï¼Œé’ˆæ³•æ‰€è¾¾ç™¾ä½™ç§ï¼Œå¸¸è§çš„æœ‰æ»šã€é“ºã€ç›–ã€æˆ³ç­‰ç­‰ï¼Œé’ˆè„šæ•´é½ã€æºè‰²è½»æŸ”ã€è™šå®åˆåº¦ã€å˜åŒ–ä¸°å¯Œã€‚ä¸€åƒå¤šå¹´æ¥ï¼Œé€æ­¥å½¢æˆã€‚ã€‚ã€‚è¯¶ï¼Œè¿™è€æ¯›ç—…å°±æ˜¯æ”¹ä¸äº†ï¼Œæ€»æ˜¯å–œæ¬¢ä¸€æœ¬æ­£ç»çš„æ‰¯çŠŠå­~~

![](http://daiweilai.github.io/img/post/2016-5-25-pic6.jpeg)

åšä¸»è¦è¯´çš„ã€æ‰“è¡¥ä¸ã€å¿…ç„¶ä¸æ˜¯é’ˆçº¿æ´»ï¼å†æ¬¡å£°æ˜è¿™é‡Œæ˜¯æŠ€æœ¯åšå®¢ï¼Œå¹¶éä¼ ç»ŸæŠ€è‰ºæˆå—ä¸­å¿ƒï¼

æˆ‘ä»¬ç»™ä¸€ä¸ªä¸œè¥¿æ‰“è¡¥ä¸ï¼ŒåŸå› å°±ä¸¤ä¸ªå­—ï¼ç ´ã€‚

æ‰€ä»¥æˆ‘ä»¬ç»™é¡¹ç›®æ‰“è¡¥ä¸ä¹Ÿæ˜¯å› ä¸ºé¡¹ç›®ç ´äº†ï¼Œå°±åƒé‡åˆ°ä¸Šé¢çš„æ•´æ”¹éœ€æ±‚ï¼ŒåŠŸèƒ½ä¸å®Œå–„äº†ï¼ŒåŠŸèƒ½ç¼ºå¤±äº†æˆ‘ä»¬å°±æœ‰äº†æ‰“è¡¥ä¸çš„å¿…è¦äº†ã€‚

åœ¨iOSä¸­æ‰“è¡¥ä¸ï¼Œæˆ‘ä»¥ä¿®è¡¥æ—¶æœºä¸ºä¸»åˆ†ä¸ºä¸¤ç§æ‰“è¡¥ä¸çš„æ–¹å¼ï¼Œ

- å¼€å‘ä¸­çš„æ‰“è¡¥ä¸
- çº¿ä¸Šçš„æ‰“è¡¥ä¸



## å¼€å‘ä¸­ä¿®è¡¥

æ—©çŸ¥ä»Šæ—¥ï¼Œä½•å¿…å½“åˆã€‚ä½•å‡ºæ­¤æ„Ÿæ…¨ï¼Ÿå‡å¦‚å¼€å§‹é¡¹ç›®çš„æ—¶å€™æ¡†æ¶è®¾è®¡å¥½ä¸€ç‚¹ï¼Œä»Šå¤©è¿˜ä¼šæ²¦è½åˆ°æ‰“è¡¥ä¸ä¹ˆï¼Ÿï¼Ÿä½†æ˜¯è€æµæ°“çš„æ•æ·å¼€å‘ã€å‘çˆ¹çš„å¼€å‘å‘¨æœŸã€é€†å¤©çš„ç”¨æˆ·éœ€æ±‚ä¹‹ä¸‹ä½•æ¥ä¼˜ç§€çš„æ¡†æ¶æ­è®¾å•Šï¼Ÿ

çœ‹ç€äº§å“æ–¹æ¡ˆï¼Œæˆ‘é¢¤æŠ–çš„å°å˜´åˆšè¦å¼ å¼€è¯´ã€ä¸€ä¸ªç¤¼æ‹œæ¡†æ¶æ­è®¾ï¼Œä¸¤ä¸ªç¤¼æ‹œç¼–ç ï¼Œåº”è¯¥â€¦ã€ç„¶è€Œè€æ¿æ‹æ‹ä½ çš„è‚©è†€ã€å°ä¼™å­ è¿™ä¸ªå‘¨æœ«å¼„å‡ºæ¥ï¼Œæˆ‘ä»¥å‰ä¹Ÿæ˜¯åšå¼€å‘çš„ï¼Œæ—¶é—´å¾ˆå……è¶³å“¦ï¼Œä¸è®¸éª—æˆ‘å–”~ã€ï¼Œè€æ¿ä½ ç¡®å®šä½ ä¸æ˜¯ä»¥å‰åšPPTçš„ã€‚

![](http://daiweilai.github.io/img/post/2016-5-25-pic7.jpg)

è¿™ä¸ªæ—¶å€™çš„å¿ƒæƒ…å°±è·Ÿåˆšçœ‹å®Œã€Šå°æ—¶ä»£ã€‹ä¸€æ ·æ†‹å±ˆã€‚æ‰€ä»¥å¼€å‘ä¸­éœ€è¦æ‰“è¡¥ä¸çš„çŠ¶å†µå¤ªå¤šäº†ï¼Œæ”¹ç»“æ„ï¼Œé‡å†™ï¼Œæ—¶é—´ä¸å¤Ÿï¼Œæ‰€ä»¥åªèƒ½æ‰“è¡¥ä¸äº†ï¼

### AOP

å½“åˆå­¦ä¹ JavaEEçš„æ—¶å€™æ¥è§¦äº†è¯¥ç†å¿µï¼Œåæ­£æ–‡é‚¹é‚¹çš„æ¦‚å¿µåšä¸»ä¹Ÿä¸è´´å‡ºæ¥äº†ï¼ŒAOPå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹çš„ç®€ç§°ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªæ‰“è¡¥ä¸çš„ç¼–ç¨‹æ–¹å¼ï¼ä¸ä¾µå…¥å¼åœ°ç»™ä¸€ä¸ªæ–¹æ³•æ·»åŠ ä»£ç ã€‚å† åä¹‹ã€ æ¶¦ç‰©ç»†æ— å£°ã®æŠ€èƒ½ã€ï¼Œå˜¿å˜¿ï¼Œæœ‰ä¸ªç‰‡å‡åçš„æ ‡é¢˜ï¼Œä½ ä»¬éƒ½å…´å¥‹äº†èµ·æ¥å‘¢~~

è‡³äºAOPçš„åŸºæœ¬ç†å¿µã€é€‚ç”¨åœºæ™¯ç­‰ï¼Œå„ä½çœ‹å®˜å°±è‡ªè¡ŒWikiå§ã€‚ä»€ä¹ˆç«Ÿç„¶è¯´åšä¸»å…¶å®ä¹Ÿä¸æ‡‚ä»€ä¹ˆæ˜¯AOPï¼ï¼ï¼![](http://daiweilai.github.io/img/post/2016-5-25-pic8.jpg)

çŸ¥é“ä»€ä¹ˆæ˜¯å­¦éœ¸ä¹ˆï¼å°±æ˜¯ä¸¾æ‰‹æŠ•è¶³é«˜åˆ†æ‹¿ä¸‹ã€ä¿¡æ‰‹æ‹ˆæ¥ç†è®ºæ¥è¾©ã€å›çœ¸ä¸€ç¬‘å…¨æ˜¯è´¥å°†ï¼ä¸è¦æ€€ç–‘ï¼è¿™å°±æ˜¯åšä¸»ï¼ŒçœŸå­¦éœ¸ï¼



![](http://daiweilai.github.io/img/post/2016-5-25-pic9.gif)

è¯´äº†è¿™ä¹ˆå¤šï¼Œåˆ°åº•æ€ä¹ˆç”¨AOPæ–¹å¼ç»™é¡¹ç›®æ‰“è¡¥ä¸å‘¢ï¼Ÿ

æˆ‘ä»¬æ¥æ‰“ä¸ªæ —å­å§ï¼

ã€åªå…è®¸æ‰€æœ‰çš„æ§ä»¶çš„å•å‡»ã€

ä¸€ä¸ªé¡¹ç›®ä¸­å°‘è¯´æˆç™¾ä¸Šåƒçš„æ§ä»¶ï¼Œå³ä½¿æœ‰äº›æ§ä»¶å¤ç”¨ï¼Œé¡¹ç›®ä¸­æ§ä»¶çš„æ•°é‡ä¹Ÿä¼šå‡ åä¸Šç™¾çš„UIæ§ä»¶æ— æ³•å¤ç”¨ï¼Œé‚£æ€ä¹ˆæŠŠè¿™å‡ åä¸Šç™¾çš„æ§ä»¶éƒ½ç¦æ­¢åŒå‡»å‘¢ï¼Ÿ

æˆ‘ä»¬çŸ¥é“UIViewæœ‰ä¸ªå±æ€§

``` objectivec
@property(nonatomic,getter=isExclusiveTouch) BOOL       exclusiveTouch __TVOS_PROHIBITED;         // default is NO
```

å¦‚æœä¸€ä¸ªViewè®¾ç½®`exclusiveTouch`ä¸ºYESçš„è¯ï¼Œé‚£ä¹ˆè¯¥Viewå°±ä¼šç‹¬å äº‹ä»¶ï¼Œå°±æ˜¯å½“ç‚¹å‡»è‡ªå·±çš„æ—¶å€™ï¼Œå…¶ä»–æ‰€æœ‰çš„Viewçš„äº‹ä»¶éƒ½ä¼šè¢«Blockï¼Œå¹¶ä¸”å½“å‰çš„Viewä¹Ÿåªèƒ½å•æ¬¡ç‚¹å‡»ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å°±èƒ½æŠŠæ‰€æœ‰çš„æ§ä»¶çš„è¿™ä¸ªå±æ€§éƒ½è®¾ç½®ä¸ºYESä¸å°±è¡Œäº†å˜›ã€‚

ç„¶åå­åƒå­åƒåœ°ç»™å‡ åä¸Šç™¾ä¸ªæ§ä»¶éƒ½è®¾ç½®äº†è¯¥å±æ€§ï¼Œçœ‹åˆ°éƒ½ç´¯ï¼Œè¿™æ ·çš„æ–¹å¼æ‰“è¡¥ä¸ï¼Œé‚£ä¸‡ä¸€äº§å“åˆæ¥äº†è¯´ä¸è¦ç¦æ­¢åŒå‡»å‘¢ï¼Ÿ

![](http://daiweilai.github.io/img/post/2016-5-25-pic10.gif)

ä½ è¿™ä¸æ˜¯åœ¨ç»™é¡¹ç›®æ‰“è¡¥ä¸ï¼Œæ˜¯åœ¨æ‰“è‡ªå·±ã€‚

æˆ‘ä»¬æœ‰ä¸‹é¢è¿™æ ·æŠ•æœºçš„æ–¹å¼ï¼š

``` objectivec
@implementation MyView //ç»§æ‰¿è‡ªUIView
+ (void)load{ //loadæ–¹æ³•æ˜¯æ‰€æœ‰ç»§æ‰¿NSObjectç±»éƒ½æ‹¥æœ‰çš„ç±»æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ç†è§£ä¸ºè¿™ä¸ªæ–¹æ³•åŠ è½½çš„ç°å¸¸æ—©ç°å¸¸çš„æ—©ï¼ï¼
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        Class class = [self class];
        //æŠŠåŸæ¥çš„æ–¹æ³•æ¢æ‰
        SEL originalSelector = @selector(willMoveToSuperview:);//Viewè¢«åŠ åˆ°çˆ¶Viewçš„æ—¶å€™çš„å›è°ƒ
        SEL swizzledSelector = @selector(ddwillMoveToSuperview:);
        
        Method originalMethod = class_getInstanceMethod(class, originalSelector);
        Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);
        
        BOOL didAddMethod =class_addMethod(class,
                                           originalSelector,
                                           method_getImplementation(swizzledMethod),
                                           method_getTypeEncoding(swizzledMethod));
        
        if (didAddMethod) {
            class_replaceMethod(class,
                                swizzledSelector,
                                method_getImplementation(originalMethod),
                                method_getTypeEncoding(originalMethod));
        } else {
            method_exchangeImplementations(originalMethod, swizzledMethod);
        }
    });
}

- (void)ddwillMoveToSuperview:(UIView *)newSuperview{
    [self ddwillMoveToSuperview:newSuperview];//è¿™ä¸ªåœ°æ–¹ å¯è‡ªè¡Œèµ„æ–™ä¸ºä½•ç”¨self
    [self setExclusiveTouch:YES];
}

@end
```

å…¶å®è¿™å°±å°±æ˜¯OCçš„Runtimeçš„ `Method Swizzling`ï¼Œå¾ˆè½»æ˜“åœ°å®ç°äº†AOPæ‰“è¡¥ä¸ï¼Œè¿™æ ·æˆ‘ä»¬çš„UIViewéƒ½åªèƒ½å•å‡»å•¦ï¼Œå“ˆå“ˆï¼Œå‡»æºƒäº§å“+1ã€‚

æ›´å¤šçš„èµ„æ–™ä»»æ„é—¨:

[Method Swizzling å’Œ AOP å®è·µ](http://tech.glowing.com/cn/method-swizzling-aop/){:target="_blank"}

å½“ç„¶å¾ˆå¤šä¼˜ç§€çš„å¼€æºé¡¹ç›®éƒ½æ˜¯æ¶¦ç‰©ç»†æ— å£°çš„è€å¸æœºï¼Œä»–ä»¬çš„åº“ä¸éœ€è¦æ·»åŠ ä»»ä½•ä»£ç å°±èƒ½è·‘èµ·æ¥ï¼Œå…¶å®è¿™ä¸ªæ–¹å¼å°±æ˜¯AOPï¼Œå°±æ˜¯ä½¿ç”¨äº†loadæ–¹æ³•å’ŒRuntimeï¼

æ¯”å¦‚ç»™é”®ç›˜æ‰“è¡¥ä¸è€å¸æœºçš„ [IQKeyboardManager](https://github.com/hackiftekhar/IQKeyboardManager){:target="_blank"}

fxxkingdã€‚ã€‚ å™¢ä¸ æ˜¯forking dogå›¢é˜Ÿçš„ç»™è¿”å›æ‰‹åŠ¿æ‰“è¡¥ä¸çš„[UITableView-FDTemplateLayoutCell](https://github.com/forkingdog/UITableView-FDTemplateLayoutCell){:target="_blank"} è¿™ä¸ªå›¢é˜Ÿè¿˜æ˜¯éå¸¸æ£’çš„ï¼ä»–ä»¬çš„å¼€æºé¡¹ç›®è´¨é‡éƒ½å¾ˆé«˜ï¼å€¼å¾—å­¦ä¹ ï¼



### Category

Categoryå¯ä»¥ç»™ä»»æ„ä¸€ä¸ªç»§æ‰¿è‡ªNSObjectçš„ç±»æ·»åŠ æ–¹æ³•ï¼Œé‡å†™æ–¹æ³•ï¼ å…¶ä½œç”¨å°±æ˜¯ä¸ºäº†è½»ç»§æ‰¿çš„ï¼Œæ‰€ä»¥åˆ©ç”¨CategoryåŒæ ·å¯ä»¥ç»™é¡¹ç›®æ‰“è¡¥ä¸ï¼

åŒæ ·çš„é—®é¢˜ 

ã€åªå…è®¸æ‰€æœ‰çš„æ§ä»¶çš„å•å‡»ã€

æˆ‘ä»¬å¯ä»¥ç»™UIViewå†™ä¸€ä¸ªCategory

``` objectivec 
#import "UIView+SingleTap.h"

@implementation UIView(SingleTap)
//è¯¥æ–¹æ³•ä¼šç›´æ¥è¦†ç›–åŸViewçš„æ–¹æ³•
-(BOOL)isExclusiveTouch{ 
    return YES;
}
@end
```

ä¸è¶³ä¹‹å¤„å°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™å¿…é¡»å¼•ç”¨è¯¥Categoryçš„å¤´æ–‡ä»¶

å½“ç„¶å¦‚æœä½ ç¡®å®šè¦å¹²æ‰æ‰€æœ‰æ§ä»¶çš„åŒå‡»ï¼Œä¹Ÿå¯ä»¥åœ¨Pché¢„ç¼–è¯‘å¤´æ–‡ä»¶ä¸­å¼•å…¥è¯¥Categoryï¼Œè¿™æ ·æ•´ä¸ªé¡¹ç›®çš„æ¯ä¸ªæ–‡ä»¶é»˜è®¤éƒ½ä¼šå¼•å…¥è¿™ä¸ªCategoryï¼Œä¸€åŠ³æ°¸é€¸äº†ã€‚



### Notification

åˆ©ç”¨é€šçŸ¥ä¹Ÿèƒ½ç»™é¡¹ç›®ä¿®ä¿®è¡¥è¡¥ã€‚

ä¸ªäººè®¤ä¸ºä½œä¸ºä¸€ä¸ªiOSå¼€å‘è€…é¦–å…ˆéƒ½è¦æœ‰ä¸€å®šçš„YYèƒ½åŠ›ï¼æ€ä¹ˆè¯´ï¼Ÿå› ä¸ºæˆ‘ä»¬å‡ ä¹ä¸å¯èƒ½çœ‹åˆ°åº”ç”¨å±‚æ¡†æ¶æºç ï¼Œæ‰€ä»¥å¾ˆå¤šå®ç°æœºåˆ¶åªèƒ½é çŒœï¼ä¹Ÿå› ä¸ºè¿™ç§çŠ¶å†µï¼Œæˆ‘è§‰å¾—iOSeréƒ½åº”è¯¥å…»æˆä¸€ä¸ªç™–å¥½â€”â€”å¯¹è‹¹æœæš´éœ²çš„æ–¹æ³•å’Œå±æ€§åˆ—è¡¨è¦è¿‘ä¹ç‹‚çƒ­åœ°æ„Ÿå…´è¶£ï¼Œæ¯”å¦‚å­¦ä¹ ä¸€ä¸ªæ¡†æ¶çš„æ—¶å€™å¤´æ–‡ä»¶ä¸­æ‰€æœ‰ä¸œè¥¿éƒ½ä¸è¦æ”¾è¿‡ï¼ä¹Ÿåº”è¯¥å­¦ä¼šæ‰«ææ–¹æ³•åˆ—è¡¨å’Œæˆå‘˜å˜é‡çš„æŠ€èƒ½ï¼Œæ¯”å¦‚æœ‰å¥½äº‹è€…æŠŠiOS Runtimeçš„æ‰€æœ‰ç§æœ‰æ¥å£éƒ½æ‰«é¢äº†å‡ºæ¥ [iOS-Runtime-Headers](https://github.com/nst/iOS-Runtime-Headers){:target="_blank"} è¿™ä¸ªä¸œè¥¿çœŸTMå¤ªèµäº†ï¼ï¼å“ˆå“ˆ

 ç°åœ¨æˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªéœ€æ±‚

ã€è®©æ‰€æœ‰çš„UITextFieldä¸å…è®¸è¾“å…¥emojiè¡¨æƒ…ã€

å¦‚æœåœ¨æ¯ä¸ªä½¿ç”¨äº†UITextFieldçš„åœ°æ–¹ä½¿ç”¨ä»£ç†æ–¹æ³•

``` objectivec
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string; 
```

ç„¶åä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„æ£€æµ‹ï¼Œå¦‚æœæ˜¯emojiçš„è¯å°±åˆ é™¤ï¼Œæƒ³æƒ³å…¨å±€æœ‰å‡ åä¸Šç™¾çš„UITextFieldï¼Œå°±èŠèŠ±ä¸€ç´§ï¼Œè¿™ä¹ˆå¤šæ”¹èµ·æ¥è›‹ç–¼ï¼Œä»¥åç»´æŠ¤èµ·æ¥è¿˜ä¼šæ›´è›‹ç¢ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•æ˜¯ç»ä¸å¯è¡Œçš„ï¼ï¼

å½“ç„¶å°±æƒ³æƒ³AOPã€å’ŒCategoryçš„æ–¹å¼äº†ï¼Œå½“ç„¶è¿™äº›æ–¹å¼å¿…ç„¶èƒ½åšåˆ°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œè¦ç”¨åˆ«çš„æ–¹æ³•ï¼

äºŒè¯ä¸è¯´æ’¸å‡º`UITextfieldDelegate.h`

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªStringå¸¸é‡ï¼çœ‹åˆ°`Notification` å…³é”®å­—å°±ç»é€¼æ˜¯æ³¨å†Œæ¥å—é€šçŸ¥ç”¨çš„äº†ï¼å¯ä»¥çŒœåˆ°UITextFieldåœ¨å„ç§çŠ¶æ€å›è°ƒæ—¶ä¼šå‘å‡ºå¥½å‡ ä¸ªé€šçŸ¥ï¼š

``` objectivec
UIKIT_EXTERN NSString *const UITextFieldTextDidBeginEditingNotification;
UIKIT_EXTERN NSString *const UITextFieldTextDidEndEditingNotification;
UIKIT_EXTERN NSString *const UITextFieldTextDidChangeNotification;
```

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç€å‡ ä¸ªé€šçŸ¥è¿™ä¹ˆåš

`AppDelegate.m`

``` objectivec
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions{
    /**
     *  ç›‘å¬å…¨å±€çš„textviewå’Œtextfieldçš„EndEidt
     */
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(enhanceGlobalInputs:) name:UITextFieldTextDidEndEditingNotification object:nil];
    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(enhanceGlobalInputs:) name:UITextViewTextDidEndEditingNotification object:nil];
    return YES;
}
   
   
- (void)enhanceGlobalInputs:(NSNotification*)notification{
    //ç§»é™¤emojiè¡¨æƒ… stringByRemovingEmojiæ˜¯æˆ‘ç»™NSStringå†™çš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºç§»é™¤Emoji
    if ([notification.name isEqualToString:@"UITextFieldTextDidEndEditingNotification"]) {
        ((UITextField *)notification.object).text = [((UITextField*)notification.object).text stringByRemovingEmoji];
    }else if([notification.name isEqualToString:@"UITextViewTextDidEndEditingNotification"]){
        ((UITextView *)notification.object).text = [((UITextView*)notification.object).text stringByRemovingEmoji];
    }
    
    //é™åˆ¶å¤§æ•° åªå…è®¸è¾“å…¥10ä½é•¿åº¦çš„æ•°å­— isPositiveFloatæ˜¯ä¸€ä¸ªåˆ¤æ–­å­—ç¬¦ä¸²ä¸­çš„æ•°å­—æ˜¯å¦æ˜¯åˆæ³•æ•°å­—çš„æ–¹æ³•,ç®€å•çš„æ­£åˆ™åŒ¹é…
    NSString*(^limitBigNum)(NSString* num) = ^(NSString* num){
        if ([Tools isPositiveFloat:num]) {
            if (num.length>10) {
                return [num substringWithRange:NSMakeRange(0, 10)];
            }else{
                return num;
            }
        }else{
            return num;
        }
    };
    if ([notification.name isEqualToString:@"UITextFieldTextDidChangeNotification"]) {
        ((UITextField *)notification.object).text = limitBigNum(((UITextField *)notification.object).text);
    }else if([notification.name isEqualToString:@"UITextViewTextDidChangeNotification"]){
        ((UITextView *)notification.object).text = limitBigNum(((UITextView *)notification.object).text);
    }
}
```



`NSString+Emoji.m`

``` objectivec
#import "NSString+Emoji.h"
#include <unicode/utf8.h>

@implementation NSString(Emoji)

- (NSString *)stringByRemovingEmoji {
    NSData *d = [self dataUsingEncoding:NSUTF8StringEncoding allowLossyConversion:NO];//æœ‰æŸè½¬æ¢
    if(!d){
        return nil;
    }
    const char *buf = (char*)d.bytes;
    NSUInteger len = [d length];
    char *str = (char *)malloc(len);//åˆ†é…char*lenå¤§å°çš„å†…å­˜
    unsigned int inputIndex = 0, outpuIndex = 0;
    int uc;//å½“å‰unicodeå­—ç¬¦çš„ç¼–ç  åè¿›åˆ¶è¡¨ç¤º
    while (inputIndex < len) {
        U8_NEXT_UNSAFE(buf, inputIndex, uc);//ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦éå†
        if(0x2100 <= uc && uc <= 0x26ff) continue;//æ˜¯emojiå°±æ”¾å¼ƒæœ¬è½®å¾ªç¯
        if(0x1d000 <= uc && uc <= 0x1f77f) continue;//æ˜¯emojiå°±æ”¾å¼ƒæœ¬è½®å¾ªç¯
        U8_APPEND_UNSAFE(str, outpuIndex, uc);//ä¸æ˜¯emojiè¡¨æƒ…ï¼Œæ·»åŠ åˆ°strä¸­
    }
    return [[NSString alloc] initWithBytesNoCopy:str length:outpuIndex encoding:NSUTF8StringEncoding freeWhenDone:YES];
}
@end
```



### å®æ›¿æ¢

æœ€åè¿™ç§æ–¹æ³•ä¹Ÿè®¸å¾ˆå¤šäººéƒ½çŸ¥é“æ€ä¹ˆç”¨äº†ï¼ŒiOSçš„ç¼–è¯‘æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼šå¯¹äºæ‹¥æœ‰ç›¸åŒæ–¹æ³•ç­¾åçš„æ–¹æ³•ï¼Œåç¼–è¯‘çš„ä¼šè¦†ç›–è¾ƒæ—©ç¼–è¯‘çš„æ–¹æ³•ã€‚

``` objectivec
#pragma mark - é‡å†™NSLog,Debugæ¨¡å¼ä¸‹æ‰“å°æ—¥å¿—å’Œå½“å‰è¡Œæ•°
#if DEBUG
#define NSLog(FORMAT, ...) fprintf(stderr,"\nfunction:%s line:%d content:%s\n", __FUNCTION__, __LINE__, [[NSString stringWithFormat:FORMAT, ##__VA_ARGS__] UTF8String]);
#else
#define NSLog(FORMAT, ...) nil
#endif
```

iOSæ¡†æ¶çš„NSLogä¼šæ¯”è¾ƒæ—©ç¼–è¯‘ï¼Œä½†æ˜¯æœ€åä¼šè¢«æˆ‘ä»¬åº”ç”¨ä¸­çš„è¦†ç›–æ‰ã€‚

è¿™æ ·å°±ç­‰äºç»™å…¨å±€çš„NSLogç»™æ‰“ä¸Šä¸€ä¸ªè¡¥ä¸äº†æˆ–è€…è¯´ç»™NSLogå¢å¼ºäº†ï¼è¿™ä¸ªå°±ä¸èµ˜è¿°äº†ã€‚



## çº¿ä¸Šçš„ä¿®è¡¥

å› ä¸ºè‹¹æœä¸€ä¸ªå¤šç¤¼æ‹œå®¡æ ¸å‘¨æœŸçš„å°¿æ€§ï¼Œç»™ä¸€ä¸ªçº¿ä¸Šçš„é¡¹ç›®æ‰“è¡¥ä¸è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯çº¿ä¸Šçš„æ‰“è¡¥ä¸æ–¹å¼æ¡ä»¶å°±è¦è‹›åˆ»è®¸å¤šäº†ï¼ä¸€èˆ¬æ˜¯åœ¨é¡¹ç›®ä¸­å…ˆæ¤å…¥ä¸€ä¸ªå¼•æ“ç±»çš„ä¸œè¥¿ï¼Œç„¶åç§»åŠ¨ç«¯å»æœåŠ¡ç«¯è·å–ä¿®è¡¥çš„æŒ‡ä»¤(Luaã€JavaScriptç­‰è„šæœ¬ï¼Œè‡³äºç”¨ä»€ä¹ˆè¯­è¨€å’Œè¿™ä¸ªä¿®è¡¥å¼•æ“çš„è®¾è®¡æœ‰å…³)ï¼Œç„¶åè¿™ä¸ªå¼•æ“ä¼šå°†æŒ‡ä»¤é€šè¿‡ä¸€å®šçš„æ˜ å°„è§„åˆ™ç”Ÿæˆæœ¬åœ°çš„çš„å¯æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ¯”å¦‚OCä¸­å¯ä»¥ä½¿ç”¨Runtimeæ–°å¢ç±»æˆ–è€…ä¿®æ”¹ç±»ï¼Œç„¶åè¾¾åˆ°æ‰“è¡¥ä¸çš„æ•ˆæœï¼Œè¿™ä¹Ÿç§°ä¸º`çƒ­æ›´æ–°`æŠ€æœ¯ï¼ä¸‹é¢çš„éƒ½æ˜¯æˆç†Ÿçš„çƒ­æ›´æ–°å¼•æ“ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹

### wax



[ä½¿ç”¨Waxç»™ä½ çš„åº”ç”¨ç¨‹åºæ‰“è¡¥ä¸](http://blog.devzeng.com/blog/ios-patch-by-wax.html){:target="_blank"}



### JSPatch

[JSPatch](https://github.com/bang590/JSPatch){:target="_blank"}



ä¸è¿‡å¦‚æœä½ çš„é¡¹ç›®æ”¯æŒäº†çƒ­æ›´æ–°ï¼Œé‚£ä¹ˆäº§å“å°±æ›´åŠ è‚†æ— å¿Œæƒ®äº†ï¼Œå› ä¸ºä½ å¯ä»¥ç»™çº¿ä¸Šçš„é¡¹ç›®æ‰“è¡¥ä¸äº†ï¼Œæ‰€ä»¥ä½ æ‡‚å¾—~~

![](http://daiweilai.github.io/img/post/2016-5-25-pic11.jpg)

ã€è¿™æ ·è¦æ”¹ä¸€ä¸‹ã€ã€‚ã€‚è¢«å“å¾—éƒ½è´¨å£åˆ†ç¦»äº†ï¼



## æ€»ç»“

è¿™ç¯‡æ–‡ä¸»è¦æ˜¯åˆ†äº«äº†æœ¬äººåœ¨æ­£å¼é¡¹ç›®ä¸­é‡åˆ°æ—¶é—´ç´§è¿«ä½†æ˜¯æ€¥éœ€å˜æ›´éœ€æ±‚çš„æ—¶å€™çš„ä¸€äº›è§£å†³æ–¹æ³•ä¸æ€è·¯ï¼Œéƒ½æ˜¯æ‹™è§ï¼Œéƒ½æ˜¯é‡è·¯å­ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯å–œæ¬¢è¿™æ ·ï¼Œå“ˆå“ˆ ï¼ˆè‡ªå¸¦BGM~æˆ‘å°±æ˜¯çˆ±éŸ³ä¹~åˆ«å«æˆ‘åœä¸‹æ¥~ï¼‰

ä½†æ˜¯ï¼Œé¢„è§æ€§çš„æ¶æ„è®¾è®¡æ€æƒ³å¯ä»¥è®©ä½ é¿å…æ‰å¾ˆå¤šçš„é‡è·¯å­ï¼Œä¸€ä»½ä»£ç çš„ä¼˜é›…ä»¥åŠå¯é éƒ½æ˜¯åœ¨ä¸€äº›è§„èŒƒçš„è®¾è®¡åŸåˆ™ä¸Šå»ºç«‹èµ·æ¥çš„ï¼Œæ‰€ä»¥å“¦ï¼Œåƒä¸€äº›åŸºæœ¬çš„è®¾è®¡åŸåˆ™æ¯”å¦‚`Don't repeat yourself`Â åŸåˆ™ï¼›å°è£…æˆç±»ï¼Œæˆ–è€…åœ¨åŸºç±»ä¸­çš„å°è£…ï¼›ä¼—å¤šè®¾è®¡æ¨¡å¼æœ‰è‰¯å¥½çš„æ‰©å±•å’Œçµæ´»ç‰¹æ€§çš„æŒ‡å¯¼ï¼›åˆæˆ–è€…åˆ©ç”¨å…¶ä»–ç¼–ç¨‹èŒƒå¼å¦‚å‡½æ•°å¼ã€å“åº”å¼æ¥å†™å‡ºæ›´åŠ å¥å£®çµæ´»çš„ä»£ç ï¼Œå¯ä»¥è®©ä½ çš„é¡¹ç›®æ›´åŠ å¥å£®ã€çµæ´»ã€ã€é«˜æ•ˆã€ä¼˜é›…ã€‚

![](http://daiweilai.github.io/img/post/2016-5-25-pic12.jpg)

æ•£äº†ï¼å›å®¶æŠ„å…šç« é¿é¿é‚ªå»äº†ï¼Œåˆè¦æ”¹éœ€æ±‚ã€‚ã€‚ã€‚ã€‚